<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Prova Online â€“ UFF</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      margin: 0;
      background: #f2f4f8;
      color: #333;
    }

    header {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px 25px;
      background: #ffffff;
      border-bottom: 1px solid #e0e0e0;
    }

    header img {
      height: 45px;
    }

    header .title {
      font-size: 18px;
      font-weight: 600;
      color: #1a237e;
    }

    .container {
      max-width: 900px;
      margin: 30px auto;
      background: #ffffff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    }

    .info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      font-weight: 600;
    }

    .timer {
      color: #d32f2f;
      font-size: 18px;
    }

    .question {
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
    }

    .question h3 {
      margin-bottom: 10px;
    }

    .alternative {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 6px 0;
      cursor: pointer;
    }

    button {
      width: 100%;
      padding: 14px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      background: #1976d2;
      color: #ffffff;
      transition: background 0.3s;
    }

    button:hover {
      background: #125ea9;
    }

    button:disabled {
      background: #9e9e9e;
      cursor: not-allowed;
    }
  </style>
</head>

<body>
  <!-- TOPO -->
  <header>
    <img
      src="https://redeunisustentavel.com.br/uff/wp-content/uploads/2021/08/logo-uff.png"
      alt="Logo UFF"
    />
    <div class="title">Universidade Federal Fluminense</div>
  </header>

  <!-- CONTEÃšDO -->
  <div class="container">
    <div class="info">
      <div>ID da Prova: <span id="provaId">---</span></div>
      <div class="timer">
        Tempo restante: <span id="tempo">--:--</span>
      </div>
    </div>

    <div id="questoes"></div>

    <button id="btnEnviar" onclick="enviarProva()">Enviar Prova</button>
  </div>

  <script>
    // ðŸ”— WEBHOOKS
    const WEBHOOK_PROVA =
      "https://webhook.artideia.com.br/webhook/renderizar_prova";
    const WEBHOOK_RESPOSTAS =
      "https://SEU_WEBHOOK/enviar-respostas";

    let provaId = null;
    let fimProvaTimestamp = null;
    let respostas = {};
    let enviada = false;
    let timerInterval = null;

    async function carregarProva() {
      try {
        const res = await fetch(WEBHOOK_PROVA, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({})
        });

        const data = await res.json();

        if (data.erro) {
          alert("Nenhuma prova disponÃ­vel no momento.");
          return;
        }

        provaId = data.prova_id;
        document.getElementById("provaId").innerText = provaId;

        fimProvaTimestamp = Date.parse(data.fim);

        if (isNaN(fimProvaTimestamp)) {
          alert("Erro ao interpretar o horÃ¡rio final da prova.");
          return;
        }

        renderizarQuestoes(data.questoes);
        iniciarTimer();
      } catch (e) {
        console.error(e);
        alert("Erro ao carregar a prova.");
      }
    }

    function renderizarQuestoes(questoes) {
      const container = document.getElementById("questoes");
      container.innerHTML = "";

      questoes.forEach((q, i) => {
        const div = document.createElement("div");
        div.className = "question";

        const titulo = document.createElement("h3");
        titulo.textContent = `${i + 1}. ${q.Enunciado}`;
        div.appendChild(titulo);

        if (
          q.Tipo_questao === "multipla" &&
          Array.isArray(q.Alternativas)
        ) {
          q.Alternativas.forEach((alt) => {
            const label = document.createElement("label");
            label.className = "alternative";

            const input = document.createElement("input");
            input.type = "radio";
            input.name = `q${i}`;
            input.value = alt.texto;

            input.addEventListener("change", () => {
              respostas[i] = alt.texto;
            });

            label.appendChild(input);
            label.appendChild(
              document.createTextNode(" " + alt.texto)
            );

            div.appendChild(label);
          });
        }

        container.appendChild(div);
      });
    }

    function iniciarTimer() {
      const el = document.getElementById("tempo");

      if (timerInterval) {
        clearInterval(timerInterval);
      }

      timerInterval = setInterval(() => {
        const agora = Date.now();
        const diff = fimProvaTimestamp - agora;

        if (diff <= 0) {
          clearInterval(timerInterval);
          el.innerText = "00:00";
          enviarProva();
          return;
        }

        const totalSegundos = Math.floor(diff / 1000);
        const min = Math.floor(totalSegundos / 60);
        const sec = totalSegundos % 60;

        el.innerText =
          String(min).padStart(2, "0") +
          ":" +
          String(sec).padStart(2, "0");
      }, 1000);
    }

    async function enviarProva() {
      if (enviada) return;

      enviada = true;
      document.getElementById("btnEnviar").disabled = true;

      try {
        await fetch(WEBHOOK_RESPOSTAS, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            prova_id: provaId,
            respostas: respostas,
            enviado_em: new Date().toISOString()
          })
        });

        alert("Prova enviada com sucesso.");
      } catch (e) {
        console.error(e);
        alert("Erro ao enviar a prova.");
      }
    }

    // ðŸš€ InicializaÃ§Ã£o
    carregarProva();
  </script>
</body>
</html>
